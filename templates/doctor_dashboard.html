{% extends "base.html" %}
{% block content %}
<h2>Doctor Dashboard: Dr. {{ doctor.name }}</h2>
<p>Availability: {{ doctor.availability }}</p>

<div class="card">
    <div class="card-header">Assigned Appointments</div>
    <div class="card-body">
        <table class="table">
            <thead>
                <tr><th>Date</th><th>Patient</th><th>Status</th><th>Action</th></tr>
            </thead>
            <tbody>
                {% for appt in appointments %}
                <tr>
                    <td>{{ appt.date_time }}</td>
                    <td>{{ appt.patient.name }}</td>
                    <td>
                        <span class="badge {% if appt.status=='Completed' %}bg-success{% elif appt.status=='Cancelled' %}bg-danger{% else %}bg-warning{% endif %}">
                            {{ appt.status }}
                        </span>
                    </td>
                    <td>
                        {% if appt.status == 'Booked' %}
                        <form method="POST" class="d-flex gap-2">
                            <input type="hidden" name="appt_id" value="{{ appt.id }}">
                            <input type="text" name="diagnosis" class="form-control form-control-sm" placeholder="Diagnosis">
                            <input type="text" name="prescription" class="form-control form-control-sm" placeholder="Rx">
                            <button name="status" value="Completed" class="btn btn-success btn-sm">Done</button>
                            <button name="status" value="Cancelled" class="btn btn-danger btn-sm">Cancel</button>
                        </form>
                        {% else %}
                        <small>{{ appt.diagnosis }} | {{ appt.prescription }}</small>
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}